<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>å± é¾™å®åˆ€ç‚¹å‡»å°±é€ï¼ˆå¸…çš„æ‰é€ï¼‰</title>
  
  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-7WJ6L7RK5W"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-7WJ6L7RK5W');
</script>

<style>
  :root {
    --bg: #0f1325;
    --panel: #182039;
    --line: #26325d;
    --text: #eaf0ff;
    --muted: #a8b2d2;
    --accent: #86a8ff;
    --accent2: #9df0d7;
    --danger: #ff6b6b;
    --success: #4cd97c;
    --crit: #ffcc00;
    --emo-color: #d3d3d3;
    --emo-dark: #a8a8a8;
  }
  
  * {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
  }
  
  html, body {
    min-height: 100%;
    background: radial-gradient(1000px 600px at 10% -10%, #1b2350 0, transparent 60%),
                radial-gradient(900px 500px at 110% 10%, #232f5f 0, transparent 60%), 
                var(--bg);
    color: var(--text);
    font: 16px/1.6 system-ui, -apple-system, Segoe UI, Roboto, "Microsoft YaHei", sans-serif;
    overflow-x: hidden;
  }
  
  .wrap {
    width: min(860px, 100%);
    margin: 20px auto;
    display: grid;
    gap: 14px;
    padding: 0 14px;
  }
  
  .card {
    background: linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.01));
    border: 1px solid var(--line);
    border-radius: 14px;
    padding: 16px;
    position: relative;
    overflow: hidden;
  }
  
  h1 {
    margin: 0 0 6px;
    font-size: 24px;
    line-height: 1.35;
  }
  
  .lead {
    margin: 6px 0 0;
    font-size: 18px;
    font-weight: 600;
    letter-spacing: .2px;
  }
  
  .muted {
    color: var(--muted);
    font-size: 14px;
  }
  
  .row {
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
  }
  
  button {
    appearance: none;
    border: none;
    cursor: pointer;
    font-weight: 700;
    border-radius: 12px;
    padding: 10px 14px;
    color: #0b1233;
    background: linear-gradient(90deg, var(--accent), var(--accent2));
    box-shadow: 0 8px 20px rgba(134,168,255,.25);
    transition: transform .05s ease;
  }
  
  button:active {
    transform: translateY(1px) scale(.99);
  }
  
  .type {
    border-right: 2px solid var(--accent);
    white-space: pre-wrap;
    min-height: 1.6em;
  }
  
  .tag {
    display: inline-block;
    padding: 3px 10px;
    border: 1px solid var(--line);
    border-radius: 999px;
    color: var(--muted);
    font-size: 12px;
    margin-bottom: 8px;
  }
  
  footer {
    color: var(--muted);
    font-size: 12px;
    text-align: center;
    padding: 10px;
  }
  
  .headcopy {
    position: relative;
    z-index: 1;
  }
  
  /* æ¸¸æˆåŒºåŸŸæ ·å¼ */
  #game-area {
    display: none;
    margin-top: 20px;
    text-align: center;
  }
  
  #emo-monster {
    width: 120px;
    height: 120px;
    margin: 0 auto 15px;
    background: linear-gradient(135deg, var(--emo-color), var(--emo-dark));
    border-radius: 50% 50% 40% 40%;
    position: relative;
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
    cursor: pointer;
    transition: transform 0.2s;
  }
  
  .eye {
    position: absolute;
    width: 30px;
    height: 30px;
    background: white;
    border-radius: 50%;
    top: 35px;
  }
  
  .eye.left {
    left: 25px;
  }
  
  .eye.right {
    right: 25px;
  }
  
  .pupil {
    position: absolute;
    width: 15px;
    height: 15px;
    background: #333;
    border-radius: 50%;
    top: 7px;
    left: 7px;
  }
  
  /* æ­»äº¡è¡¨æƒ… */
  .dead-eye {
    position: absolute;
    width: 30px;
    height: 30px;
    top: 35px;
  }
  
  .dead-eye::before,
  .dead-eye::after {
    content: "";
    position: absolute;
    height: 3px;
    background: #333;
    top: 14px;
    left: 0;
    width: 100%;
  }
  
  .dead-eye::before {
    transform: rotate(45deg);
  }
  
  .dead-eye::after {
    transform: rotate(-45deg);
  }
  
  .dead-eye.left {
    left: 25px;
  }
  
  .dead-eye.right {
    right: 25px;
  }
  
  #health-container {
    width: 250px;
    margin: 0 auto 15px;
  }
  
  #health-text {
    text-align: center;
    margin-bottom: 5px;
    font-size: 14px;
  }
  
  #health-bar {
    width: 100%;
    height: 20px;
    background: var(--panel);
    border-radius: 10px;
    overflow: hidden;
    border: 1px solid var(--line);
  }
  
  #health {
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, var(--danger), #ff8e8e);
    transition: width 0.3s;
  }
  
  /* å¢å¤§å± é¾™å®åˆ€å›¾æ ‡ */
  #sword {
    display: none;
    position: absolute;
    width: 80px;  /* ä»40pxå¢åŠ åˆ°80px */
    height: 80px; /* ä»40pxå¢åŠ åˆ°80px */
    background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><path fill="%23ffd700" d="M50 10L60 40H40L50 10z"/><rect x="48" y="40" width="4" height="50" fill="%23c0c0c0"/><rect x="45" y="90" width="10" height="5" fill="%23a52a2a"/><rect x="40" y="95" width="20" height="5" fill="%238b4513"/><circle cx="50" cy="20" r="5" fill="%23red"/></svg>') no-repeat center/contain;
    pointer-events: none;
    z-index: 100;
    transform-origin: center 70%; /* è°ƒæ•´æ—‹è½¬ä¸­å¿ƒç‚¹ */
    filter: drop-shadow(0 0 5px rgba(255, 215, 0, 0.8));
  }
  
  /* ä¼¤å®³æ•°å€¼æ ·å¼ */
  .damage-text {
    position: absolute;
    font-weight: bold;
    pointer-events: none;
    z-index: 200;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
    animation: floatUp 1s forwards;
  }
  
  @keyframes floatUp {
    0% {
      transform: translateY(0);
      opacity: 1;
    }
    100% {
      transform: translateY(-50px);
      opacity: 0;
    }
  }
  
  .crit-text {
    color: var(--crit);
    font-size: 20px;
    animation: critFloat 1s forwards;
  }
  
  @keyframes critFloat {
    0% {
      transform: translateY(0) scale(1);
      opacity: 1;
    }
    50% {
      transform: translateY(-25px) scale(1.5);
    }
    100% {
      transform: translateY(-50px) scale(1);
      opacity: 0;
    }
  }
  
  /* æš´å‡»ç‰¹æ•ˆ */
  .crit-effect {
    position: absolute;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 150;
    background: radial-gradient(circle, rgba(255, 204, 0, 0.4) 0%, transparent 70%);
    animation: critFlash 0.5s forwards;
  }
  
  @keyframes critFlash {
    0% {
      opacity: 1;
      transform: scale(0.5);
    }
   100% {
      opacity: 0;
      transform: scale(1.5);
    }
  }
  
  /* æš´å‡»æç¤º */
  .crit-tip {
    text-align: center;
    margin-top: 10px;
    font-size: 12px;
    color: var(--crit);
    animation: pulse 2s infinite;
  }
  
  @keyframes pulse {
    0% { opacity: 0.7; }
    50% { opacity: 1; }
    100% { opacity: 0.7; }
  }
  
  /* éŸ³ä¹æ§åˆ¶ */
  .music-control {
    position: fixed;
    bottom: 20px;
    right: 20px;
    z-index: 1000;
    background: var(--panel);
    border: 1px solid var(--line);
    border-radius: 50%;
    width: 50px;
    height: 50px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
  }
  
  .music-control i {
    font-size: 24px;
    color: var(--accent);
  }
  
  .music-control.muted i {
    color: var(--muted);
  }
  
  /* å¼¹çª—æ ·å¼ */
  .modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(15, 19, 37, 0.9);
    z-index: 1000;
    justify-content: center;
    align-items: center;
  }
  
  .modal-content {
    background: var(--panel);
    border: 1px solid var(--line);
    border-radius: 14px;
    padding: 25px;
    max-width: 400px;
    width: 90%;
    text-align: center;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
  }
  
  .modal h2 {
    margin-bottom: 15px;
    color: var(--accent);
  }
  
  .modal p {
    margin-bottom: 20px;
  }
  
  .modal-buttons {
    display: flex;
    justify-content: center;
    gap: 15px;
  }
  
  .modal-btn {
    min-width: 80px;
  }
  
  .modal-btn.yes {
    background: linear-gradient(90deg, var(--success), #6cdf9c);
  }
  
  /* å“åº”å¼è®¾è®¡ */
  @media (max-width: 480px) {
    h1 { font-size: 22px; }
    .lead { font-size: 16px; }
    .row { flex-direction: column; }
    #emo-monster { width: 100px; height: 100px; }
    #health-container { width: 200px; }
    .eye, .dead-eye {
      width: 25px;
      height: 25px;
      top: 30px;
    }
    .eye.left, .dead-eye.left { left: 20px; }
    .eye.right, .dead-eye.right { right: 20px; }
    .pupil {
      width: 12px;
      height: 12px;
      top: 6px;
      left: 6px;
    }
    #sword {
      width: 60px;
      height: 60px;
    }
    .music-control {
      bottom: 10px;
      right: 10px;
      width: 40px;
      height: 40px;
    }
    .music-control i {
      font-size: 20px;
    }
  }
</style>
<!-- å¼•å…¥å­—ä½“å›¾æ ‡ -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
<div class="wrap">
  <header class="card">
    <div class="headcopy">
      <h1>å“¦è«ï¼Œ<span id="toName">æ˜¯è°åœ¨å‘å…‰ï¼</span>å¥½é—ªï¼ âœ¨</h1>
      <p class="lead">åŸæ¥æ˜¯å”±æ­Œåˆå¥½å¬ã€é•¿å¾—åˆå¥½çœ‹ã€æ¸¸æˆè¿˜æ‰“å¾—å¥½çš„ã€åšä»€ä¹ˆéƒ½ä¼šæˆåŠŸçš„ <b>å…¨ä¸–ç•Œæœ€å¥½çš„ å·´zei åŒå­¦</b>å‘€ï¼</p>
      <div class="muted">åŠªåŠ›çš„å·´zeiåŒå­¦å¾ˆé…·ï¼Œä½†æ˜¯èƒ½åœä¸‹æ¥å‘å‘å‘†çœ‹çœ‹äº‘çš„å·´zeiåŒå­¦æ›´ï¼æ˜¯ï¼è¶…ï¼çº§ï¼é…·ï¼</div>
    </div>
  </header>

  <div class="card">
    <div class="tag">ğŸ¯ ä»Šå¤©çš„å·´zeiåŒå­¦å¼€å¿ƒäº†å—ï¼Ÿ</div>
    <p id="quote" class="type"></p>
    <div class="row">
      <button id="btnNew">é•¿å¾—å¸…çš„éƒ½ç‚¹æˆ‘</button>
      <button id="btnGetSword">ç‚¹å‡»é¢†å–å± é¾™å®åˆ€</button>
      <span class="muted" style="align-self:center">é¢†å–å®åˆ€åï¼Œç‚¹å‡»emoæ€ªè¿›è¡Œæ”»å‡»</span>
    </div>
    <div id="counter" class="muted" style="text-align: right; margin-top: 8px; font-size: 12px;">å·²å±•ç¤º: 0/10</div>
  </div>

  <!-- æ¸¸æˆåŒºåŸŸ -->
  <div id="game-area" class="card">
    <div class="tag">âš”ï¸ å·´zeiå¤§ä¾ å¤§æˆ˜emoæ€ª</div>
    <div id="health-container">
      <div id="health-text">HP: 8888/8888</div>
      <div id="health-bar">
        <div id="health"></div>
      </div>
    </div>
    <div id="emo-monster">
      <div class="eye left"><div class="pupil"></div></div>
      <div class="eye right"><div class="pupil"></div></div>
    </div>
    <p class="muted">ä½¿ç”¨å± é¾™å®åˆ€ç‚¹å‡»emoæ€ªè¿›è¡Œæ”»å‡»ï¼</p>
    <div class="crit-tip">ğŸ’¥ è¶Šå¼ºè¶Šå¸…æš´å‡»æ¦‚ç‡è¶Šå¤§ï¼</div>
  </div>

  <footer>Â© <span id="year"></span> é‡äº‹ä¸è¦æ…Œï¼Œè¿˜èƒ½æ‰¾ä¸«ä¸«</footer>
</div>

<!-- å± é¾™å®åˆ€å›¾æ ‡ -->
<div id="sword"></div>

<!-- éŸ³ä¹æ§åˆ¶ -->
<div id="music-control" class="music-control">
  <i class="fas fa-volume-up"></i>
</div>

<!-- å¼¹çª— -->
<div id="victory-modal" class="modal">
  <div class="modal-content">
    <h2>ğŸ‰ å·´zeiå°‘ä¾ å®Œèƒœemoæ€ª</h2>
    <p>æ­å–œä½ æˆåŠŸå‡»è´¥äº†emoæ€ªï¼</p>
    <button id="confirm-victory" class="modal-btn">ç¡®è®¤</button>
  </div>
</div>

<div id="loot-modal" class="modal">
  <div class="modal-content">
    <h2>ğŸ æ‰è½è£…å¤‡</h2>
    <p>æ˜¯å¦æ¡å–æ‰è½è£…å¤‡ï¼Ÿ</p>
    <div class="modal-buttons">
      <button id="btn-yes" class="modal-btn yes">æ˜¯</button>
      <button id="btn-ofcourse" class="modal-btn">å½“ç„¶</button>
    </div>
  </div>
</div>

<div id="buff-modal" class="modal">
  <div class="modal-content">
    <h2>âœ¨ è·å¾—æ°¸ä¹…Buff</h2>
    <p>æˆåŠŸè·å¾—æ°¸ä¹…buffï¼š<strong>å·´zeiå°‘ä¾ å¤©å¤©å¼€å¿ƒ</strong></p>
    <button id="close-buff" class="modal-btn">å¤ªæ£’äº†ï¼</button>
  </div>
</div>

<!-- æ–‡æ¡ˆå­˜ JSON -->
<script type="application/json" id="quotes-json">
[
  "å§æ§½ï¼Œç§ç§ï¼Œè¿™æ˜¯è°ï¼Ÿæ˜¯å…¨ä¸–ç•Œæœ€å¥½çš„å·´zeiåŒå­¦ï¼",
  "å·´zeiåŒå­¦å¹´çºªè½»è½»å®Œæˆäººç”Ÿå°ç›®æ ‡ï¼Œèººï¼Œè¿™å¾—èººï¼",
  "å¿ƒå³ç†ä¹Ÿã€‚",
  "èº«ä½“æ‰æ˜¯é©å‘½çš„æœ¬é’±ã€‚",
  "ä¸å…¶é€¼è‡ªå·±ä¸€æŠŠï¼Œä¸å¦‚æ”¾è‡ªå·±ä¸€é©¬ã€‚",
  "å¯æ˜¯æˆ‘ä»¬å·´zeiåŒå­¦ï¼Œå°±æ˜¯å¾ˆå¥½å¾ˆå¥½ä¼šå‘å…‰å‘€ï½",
  "èººå¹³ä¸æ˜¯æ‘†çƒ‚ï¼Œæ˜¯ä¼‘å…»ç”Ÿæ¯ï½",
  "å·´zeiåŒå­¦å€¼å¾—æ‹¥æœ‰ä¸–ç•Œä¸Šæ‰€æœ‰çš„å¥½ä¸œè¥¿ã€‚",
  "ä½ ä¸ä¼šæœ‰è¿‡ä¸å»çš„åï¼Œå› ä¸ºä½ çš„è…¿ä¸å¤ŸçŸ­ã€‚",
  "å°‘ä¾ è¦åœ¨æ±Ÿæ¹–æœ‰ä¸€å¸­ä¹‹åœ°ï¼Œéœ€å¾—åŠ³é€¸ç»“åˆã€‚",
  "æ€»è£ä¹Ÿéœ€è¦é€‚å½“æ‘¸é±¼ã€‚",
  "å¤§æ–¹å‘ä½ å·²ç»å®Œäº‹å„¿äº†ï¼Œç°åœ¨éœ€è¦çš„æ˜¯äº«å—ï¼äº«å—äººç”Ÿï¼Œå°± å’±å¿«ä¹å°±å®Œäº‹å„¿äº†ï¼ï¼"
]
</script>

<!-- éŸ³é¢‘å…ƒç´  - ä½¿ç”¨æ‚¨æä¾›çš„GitHubé“¾æ¥ -->
<audio id="bgm" src="https://github.com/pyx0320/To-the-best-ba-zei/raw/main/bgm_emo%E6%80%AA.mp3" loop preload="auto"></audio>

<audio id="attack-sound">
  <source src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_5bdcb6f6e7.mp3?filename=whoosh-6316.mp3" type="audio/mpeg">
</audio>

<audio id="crit-sound">
  <source src="https://cdn.pixabay.com/download/audio/2022/03/19/audio_2a5525d600.mp3?filename=power-up-6768.mp3" type="audio/mpeg">
</audio>

<audio id="victory-sound">
  <source src="https://cdn.pixabay.com/download/audio/2021/10/25/audio_7b60723d8c.mp3?filename=success-1-6297.mp3" type="audio/mpeg">
</audio>

<script>
  const $ = s => document.querySelector(s);
  const elQuote = $("#quote"), elYear = $("#year"), elCounter = $("#counter");
  const btnNew = $("#btnNew"), btnGetSword = $("#btnGetSword");
  const gameArea = $("#game-area"), emoMonster = $("#emo-monster");
  const healthBar = $("#health"), healthText = $("#health-text");
  const sword = $("#sword");
  const victoryModal = $("#victory-modal"), lootModal = $("#loot-modal");
  const buffModal = $("#buff-modal");
  const musicControl = $("#music-control");
  
  // éŸ³é¢‘å…ƒç´ 
  const bgm = $("#bgm");
  const attackSound = $("#attack-sound");
  const critSound = $("#crit-sound");
  const victorySound = $("#victory-sound");
  
  // è§£æ JSON æ–‡æ¡ˆ
  let QUOTES = [];
  try {
    QUOTES = JSON.parse(document.getElementById('quotes-json').textContent.trim());
  } catch(e) {
    QUOTES = ["æ–‡æ¡ˆè§£æå¤±è´¥ï¼Œä½†ä½ ä¾ç„¶å¾ˆé…·ã€‚"];
  }

  // æ¸¸æˆå˜é‡
  let hasSword = false;
  let monsterHealth = 8888;
  let maxHealth = 8888;
  let typeTimer = null;
  let attackCooldown = false;
  let isMonsterDead = false;
  let hitCount = 0;
  let isMusicPlaying = false;
  
  // æ–‡æ¡ˆæ˜¾ç¤ºç®¡ç†
  let usedIndices = new Set();
  let currentIndex = -1;
  
  function updateCounter() {
    elCounter.textContent = `å·²å±•ç¤º: ${usedIndices.size}/${QUOTES.length}`;
  }
  
  function typeText(el, text, speed = 18) {
    if (typeTimer) {
      clearInterval(typeTimer);
      typeTimer = null;
    }
    
    let i = 0; 
    el.textContent = "";
    
    el.classList.remove("type");
    void el.offsetWidth;
    el.classList.add("type");
    
    typeTimer = setInterval(() => {
      if (i < text.length) {
        el.textContent += text[i];
        i++;
      } else {
        clearInterval(typeTimer);
        typeTimer = null;
      }
    }, speed);
  }

  function newQuote() {
    // å¦‚æœæ‰€æœ‰æ–‡æ¡ˆéƒ½å·²ä½¿ç”¨è¿‡ï¼Œé‡ç½®
    if (usedIndices.size >= QUOTES.length) {
      usedIndices.clear();
    }
    
    // åˆ›å»ºä¸€ä¸ªå¯ç”¨ç´¢å¼•æ•°ç»„
    const availableIndices = [];
    for (let i = 0; i < QUOTES.length; i++) {
      if (!usedIndices.has(i) && i !== currentIndex) {
        availableIndices.push(i);
      }
    }
    
    // éšæœºé€‰æ‹©ä¸€ä¸ªå¯ç”¨ç´¢å¼•
    if (availableIndices.length > 0) {
      const randomIndex = Math.floor(Math.random() * availableIndices.length);
      currentIndex = availableIndices[randomIndex];
      usedIndices.add(currentIndex);
      
      const pick = QUOTES[currentIndex];
      typeText(elQuote, pick);
      updateCounter();
    }
  }

  // åˆå§‹åŒ–å± é¾™å®åˆ€
  function initSword() {
    hasSword = true;
    sword.style.display = "block";
    gameArea.style.display = "block";
    btnGetSword.textContent = "å·²é¢†å–å± é¾™å®åˆ€";
    btnGetSword.disabled = true;
    
    // å¼€å§‹æ’­æ”¾BGM
    playBGM();
    
    // å®åˆ€è·Ÿéšé¼ æ ‡
    document.addEventListener("mousemove", moveSword);
    
    // ç‚¹å‡»emoæ€ªäº‹ä»¶
    emoMonster.addEventListener("click", attackMonster);
  }
  
  function moveSword(e) {
    // è°ƒæ•´ä½ç½®åç§»ï¼Œä½¿å®åˆ€ä¸­å¿ƒå¯¹å‡†é¼ æ ‡
    sword.style.left = (e.pageX - 40) + "px"; // ä»-20æ”¹ä¸º-40ï¼Œå› ä¸ºå®åˆ€å˜å¤§äº†
    sword.style.top = (e.pageY - 40) + "px"; // ä»-20æ”¹ä¸º-40ï¼Œå› ä¸ºå®åˆ€å˜å¤§äº†
  }
  
  function attackMonster() {
    if (!hasSword || attackCooldown || isMonsterDead) return;
    
    // æ”»å‡»å†·å´
    attackCooldown = true;
    setTimeout(() => {
      attackCooldown = false;
    }, 200);
    
    // æ”»å‡»åŠ¨ç”» - å¢åŠ æ›´æ˜æ˜¾çš„æŒ¥åŠ¨æ•ˆæœ
    sword.style.transform = "rotate(-45deg) translateY(5px)";
    setTimeout(() => {
      sword.style.transform = "rotate(0deg) translateY(0)";
    }, 150);
    
    // è®¡ç®—æš´å‡»æ¦‚ç‡ (éšç€æ”»å‡»æ¬¡æ•°å¢åŠ è€Œæé«˜)
    hitCount++;
    let critChance = 0.15 + (Math.min(hitCount, 20) * 0.01);
    let isCrit = Math.random() < critChance;
    
    // è®¡ç®—ä¼¤å®³ (åŸºç¡€ä¼¤å®³ + éšæœºä¼¤å®³)
    let baseDamage = isCrit ? 166 : 66;
    let randomDamage = Math.floor(Math.random() * 16);
    let totalDamage = baseDamage + randomDamage;
    
    // åº”ç”¨ä¼¤å®³
    monsterHealth -= totalDamage;
    if (monsterHealth < 0) monsterHealth = 0;
    
    // æ›´æ–°è¡€æ¡
    healthBar.style.width = (monsterHealth / maxHealth * 100) + "%";
    healthText.textContent = `HP: ${monsterHealth}/${maxHealth}`;
    
    // æ’­æ”¾éŸ³æ•ˆ
    if (isCrit) {
      playSound(critSound);
    } else {
      playSound(attackSound);
    }
    
    // æ˜¾ç¤ºä¼¤å®³æ•°å€¼
    showDamage(totalDamage, isCrit);
    
    // æ€ªç‰©å—å‡»åŠ¨ç”»
    emoMonster.style.transform = "scale(0.9)";
    setTimeout(() => {
      emoMonster.style.transform = "scale(1)";
    }, 200);
    
    // æ£€æŸ¥æ˜¯å¦å‡»è´¥
    if (monsterHealth <= 0) {
      isMonsterDead = true;
      updateMonsterFace(true);
      // åœæ­¢BGM
      pauseBGM();
      // æ’­æ”¾èƒœåˆ©éŸ³æ•ˆ
      playSound(victorySound);
      setTimeout(() => {
        victoryModal.style.display = "flex";
      }, 500);
    }
  }
  
  function showDamage(amount, isCrit) {
    // åˆ›å»ºä¼¤å®³æ–‡æœ¬å…ƒç´ 
    const damageText = document.createElement('div');
    damageText.className = `damage-text ${isCrit ? 'crit-text' : ''}`;
    damageText.textContent = isCrit ? `æš´å‡»! -${amount}` : `-${amount}`;
    
    // è®¾ç½®ä½ç½®
    const rect = emoMonster.getBoundingClientRect();
    damageText.style.left = `${rect.left + rect.width/2}px`;
    damageText.style.top = `${rect.top}px`;
    
    // æ·»åŠ åˆ°é¡µé¢
    document.body.appendChild(damageText);
    
    // æš´å‡»ç‰¹æ•ˆ
    if (isCrit) {
      const critEffect = document.createElement('div');
      critEffect.className = 'crit-effect';
      critEffect.style.left = `${rect.left}px`;
      critEffect.style.top = `${rect.top}px`;
      critEffect.style.width = `${rect.width}px`;
      critEffect.style.height = `${rect.height}px`;
      document.body.appendChild(critEffect);
      
      // ç§»é™¤ç‰¹æ•ˆå…ƒç´ 
      setTimeout(() => {
        document.body.removeChild(critEffect);
      }, 500);
    }
    
    // ç§»é™¤æ–‡æœ¬å…ƒç´ 
    setTimeout(() => {
      document.body.removeChild(damageText);
    }, 1000);
  }
  
  // æ›´æ–°emoæ€ªè¡¨æƒ…
  function updateMonsterFace(isDead) {
    const eyes = emoMonster.querySelectorAll('.eye');
    const pupils = emoMonster.querySelectorAll('.pupil');
    
    if (isDead) {
      // ç§»é™¤æ­£å¸¸çœ¼ç›
      eyes.forEach(eye => eye.style.display = 'none');
      pupils.forEach(pupil => pupil.style.display = 'none');
      
      // æ·»åŠ æ­»äº¡çœ¼ç›
      const leftDeadEye = document.createElement('div');
      leftDeadEye.className = 'dead-eye left';
      emoMonster.appendChild(leftDeadEye);
      
      const rightDeadEye = document.createElement('div');
      rightDeadEye.className = 'dead-eye right';
      emoMonster.appendChild(rightDeadEye);
      
      // æ”¹å˜emoæ€ªé¢œè‰²
      emoMonster.style.background = 'linear-gradient(135deg, #696969, #808080)';
    } else {
      // æ¢å¤æ­£å¸¸çœ¼ç›
      eyes.forEach(eye => eye.style.display = 'block');
      pupils.forEach(pupil => pupil.style.display = 'block');
      
      // ç§»é™¤æ­»äº¡çœ¼ç›
      const deadEyes = emoMonster.querySelectorAll('.dead-eye');
      deadEyes.forEach(eye => eye.remove());
      
      // æ¢å¤emoæ€ªé¢œè‰²
      emoMonster.style.background = 'linear-gradient(135deg, var(--emo-color), var(--emo-dark))';
    }
  }
  
  // éŸ³é¢‘æ§åˆ¶å‡½æ•°
  function playBGM() {
    bgm.volume = 0.5; // è®¾ç½®éŸ³é‡
    bgm.play().catch(e => {
      console.log("è‡ªåŠ¨æ’­æ”¾BGMè¢«é˜»æ­¢ï¼Œéœ€è¦ç”¨æˆ·äº¤äº’");
    });
    isMusicPlaying = true;
    musicControl.classList.remove("muted");
  }
  
  function pauseBGM() {
    bgm.pause();
    isMusicPlaying = false;
    musicControl.classList.add("muted");
  }
  
  function playSound(sound) {
    sound.currentTime = 0; // é‡ç½®éŸ³é¢‘åˆ°å¼€å§‹
    sound.volume = 0.5; // è®¾ç½®éŸ³é‡
    sound.play().catch(e => {
      console.log("æ’­æ”¾éŸ³æ•ˆå¤±è´¥", e);
    });
  }
  
  // å¼¹çª—æµç¨‹
  $("#confirm-victory").addEventListener("click", () => {
    victoryModal.style.display = "none";
    lootModal.style.display = "flex";
  });
  
  $("#btn-yes").addEventListener("click", () => {
    lootModal.style.display = "none";
    buffModal.style.display = "flex";
  });
  
  $("#btn-ofcourse").addEventListener("click", () => {
    lootModal.style.display = "none";
    buffModal.style.display = "flex";
  });
  
  $("#close-buff").addEventListener("click", () => {
    buffModal.style.display = "none";
    // é‡æ–°å¼€å§‹æ¸¸æˆ
    location.reload();
  });
  
  // åˆå§‹åŒ–
  (function init() { 
    elYear.textContent = new Date().getFullYear(); 
    newQuote(); 
    
    // æ·»åŠ äº‹ä»¶ç›‘å¬
    btnNew.addEventListener("click", e => { 
      e.stopPropagation(); 
      newQuote(); 
    });
    
    btnGetSword.addEventListener("click", e => { 
      e.stopPropagation(); 
      initSword(); 
    });
    
    // éŸ³ä¹æ§åˆ¶
    musicControl.addEventListener("click", () => {
      if (isMusicPlaying) {
        pauseBGM();
      } else {
        playBGM();
      }
    });
  })();
</script>
</body>
</html>
